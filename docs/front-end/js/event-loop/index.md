# jsæ‰§è¡Œæœºåˆ¶è¯¦è§£
## å‰è¨€

ç†è§£ javascript çš„æ‰§è¡Œæœºåˆ¶æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„ç¼–å†™ä»£ç é€»è¾‘ä»¥åŠæ’æŸ¥é—®é¢˜ã€‚

æŠ›ç –å¼•ç‰ï¼Œå…ˆä¸Šä¸ªğŸŒ°ï¼š
```js
console.log(1)

setTimeout(() => {
  console.log(2)
  new Promise(resolve => {
    console.log(3)
    resolve()
  }).then(() => {
    console.log(4)
  })
})

new Promise(resolve => {
  console.log(5)
  resolve()
}).then(() => {
  console.log(6)
})

setTimeout(() => {
  console.log(7)
  new Promise(resolve => {
    console.log(8)
    resolve()
  }).then(() => {
    console.log(9)
  })
})
```
![](./img/think.jpg)

ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹ç›¸å…³çŸ¥è¯†ç‚¹ï¼š

## javascript

javascript æ˜¯ä¸€é—¨ <strong style="font-size:20px">å•çº¿ç¨‹</strong> è¯­è¨€ï¼Œä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ä¸ç”¨æˆ·äº¤äº’ï¼Œä»¥åŠæ“ä½œ DOM ï¼Œè¿™ä¸ªæ€§è´¨ä¹Ÿå†³å®šäº†å®ƒæ˜¯å•çº¿ç¨‹ï¼Œä¸ç„¶å¤šçº¿ç¨‹çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤æ‚æ€§çš„åŒæ­¥é—®é¢˜ã€‚ä¸ºåˆ©ç”¨å¤šæ ¸ CPU çš„è®¡ç®—èƒ½åŠ›ï¼Œæœ€æ–°çš„ HTML5 ä¸­æå‡ºçš„ [Web-Worker](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers) æ ‡å‡†ï¼Œå…è®¸ javascript åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹æ§åˆ¶ï¼Œä¸”ä¸å¾—æ“ä½œ DOMã€‚æ‰€ä»¥ javascript æ˜¯å•çº¿ç¨‹çš„æ ¸å¿ƒä»æœªæ”¹å˜ï¼Œä¸€åˆ‡ javascript ç‰ˆçš„ â€œå¤šçº¿ç¨‹â€ éƒ½æ˜¯å•çº¿ç¨‹æ¨¡æ‹Ÿå‡ºæ¥çš„ã€‚

### äº‹ä»¶å¾ªç¯

æ—¢ç„¶æ˜¯å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰å¾…ã€‚å› æ­¤å¤§ä½¬ä»¬å°±æŠŠä»»åŠ¡åˆ†æˆäº†ä¸¤ç±»ï¼š

1. åŒæ­¥: åªæœ‰å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚
2. å¼‚æ­¥: å½“åŒæ­¥ä»»åŠ¡æ‰§è¡Œåˆ°æŸä¸ª WebAPI æ—¶ï¼Œä¼šè§¦å‘å¼‚æ­¥æ“ä½œï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå•ç‹¬å¼€çº¿ç¨‹å»å¤„ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡ã€‚

ä¸‹é¢ç”¨æœ€ç«çš„å¯¼å›¾æ¥è¡¥å……è¯´æ˜ä¸‹ï¼š

![](./img/event-loop.png)

ç”¨æ–‡å­—æ¥è¡¨è¿°çš„è¯ï¼š

1. åŒæ­¥ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼Œå¼‚æ­¥ä»»åŠ¡è¿›å…¥ Event Table æ³¨å†Œç«™è¿›è¡Œæ³¨å†Œå‡½æ•°ã€‚
2. å½“æŒ‡å®šçš„äº‹æƒ…å®Œæˆæ—¶ï¼ŒEvent Table ä¼šå°†è¿™ä¸ªäº‹æƒ…å¯¹åº”çš„å‡½æ•°ç§»å…¥ Event Queue è¿™ä¸ªç¼“å†²åŒºã€‚
3. ä¸»çº¿ç¨‹å†…çš„ä»»åŠ¡æ‰§è¡Œå®Œä¸ºç©ºæ—¶ï¼Œå°±ä¼šå» Event Queue è¯»å–å¯¹åº”çš„å‡½æ•°ï¼Œè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œã€‚
4. jså¼•æ“çš„ monitoring process è¿›ç¨‹ä¼šæŒç»­ä¸æ–­çš„æ£€æŸ¥ä¸»çº¿ç¨‹æ‰§è¡Œæ ˆæ˜¯å¦ä¸ºç©ºï¼Œä¸€æ—¦ä¸ºç©ºï¼Œå°±ä¼šå»ç¼“å†²åŒºæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œä¸Šè¿°è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ Event Loop (äº‹ä»¶å¾ªç¯)ã€‚

è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸å¦‚æ¥çœ‹ä¸€æ®µä»£ç ï¼š

```js
console.log('1')
setTimeout(() => { 
  console.log('2')
}, 0)
console.log('3')
```

ä¸Šé¢ä¸€æ®µç®€æ˜“çš„ setTimeout ä»£ç ï¼š

1. è¾“å‡º1
2. é‡åˆ° setTimeout è¿›å…¥ Event Tableï¼Œæ³¨å†Œå›è°ƒå‡½æ•° <code>() => { console.log('2') }</code>
3. è¾“å‡º3
4. ä¸»çº¿ç¨‹ä» Event Queue è¯»å–å›è°ƒå‡½æ•°å¹¶æ‰§è¡Œè¾“å‡º2

#### micro task ä¸ macro task

å¼‚æ­¥ä»»åŠ¡çš„ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œå®ƒä»¬è¢«åˆ†ä¸ºä¸¤ç±»ï¼š 

1. å¾®ä»»åŠ¡ï¼ˆmicro taskï¼‰: Promiseï¼Œprocess.nextTickï¼ŒMutationObserver...
2. å®ä»»åŠ¡ï¼ˆmacro taskï¼‰ï¼šåŒ…æ‹¬æ•´ä½“ä»£ç scriptï¼ŒsetTimeoutï¼ŒserIntervalï¼ŒsetImmediateï¼ŒI/Oï¼ŒUIrendering...

æ ¹æ®å¼‚æ­¥äº‹ä»¶çš„ç±»å‹ï¼Œè¿™äº›äº‹ä»¶ä¼šè¢«æ´¾å‘åˆ°å¯¹åº”çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ä¸­ï¼Œåœ¨å½“å‰ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼š

1. é¦–å…ˆåœ¨ å®ä»»åŠ¡ çš„é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åå–å‡º å¾®ä»»åŠ¡ é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œã€‚
2. å†å– å®ä»»åŠ¡ å‘¨è€Œå¤å§‹ï¼Œç›´è‡³ä¸¤ä¸ªé˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å–å®Œã€‚

æˆ‘ä»¬ç”¨å›¾æ¥è¯´æ˜ä¸€ä¸‹ï¼š

![](./img/task.png)

æ¥çœ‹ä¸€æ®µä»£ç ç†è§£ä¸‹ï¼š

```js
setTimeout(() => {
  console.log('setTimeout')
})

new Promise((resolve) => {
  console.log('promise')
  resolve()
}).then(() => {
  console.log('then')
})

console.log('console')
```

ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯

-  å®ä»»åŠ¡
  -  æ•´ä½“script
-  å¾®ä»»åŠ¡
  -  then

1. é¦–å…ˆæ•´ä½“scriptä½œä¸ºå®ä»»åŠ¡ï¼Œè¿›å…¥ä¸»çº¿ç¨‹ã€‚
2. å…ˆé‡åˆ° setTimeout æ³¨å†Œåæ´¾å‘åˆ°å®ä»»åŠ¡ã€‚
3. å†é‡åˆ° Promiseï¼Œnew Promise ç«‹å³æ‰§è¡Œï¼Œthen å‡½æ•°æ´¾å‘åˆ°å¾®ä»»åŠ¡ã€‚
4. `console.log('console')`ï¼Œç«‹å³æ‰§è¡Œã€‚

å¼€å§‹ç¬¬äºŒè½®

-  å®ä»»åŠ¡
  -  setTimeout
-  å¾®ä»»åŠ¡
  -  æ— 

1. ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ç»“æŸäº†ï¼Œæˆ‘ä»¬å¼€å§‹ç¬¬äºŒè½®å¾ªç¯ï¼Œå½“ç„¶è¦ä»å®ä»»åŠ¡Event Queue å¼€å§‹å‘ç° setTimeout ç«‹å³æ‰§è¡Œã€‚

ç»“æœè¾“å‡ºï¼š

```js
promise
console
then
setTimeout
```

æœ€åå›è¿‡å¤´æ¥ï¼Œè®©æˆ‘ä»¬å†åˆ†æä¸‹æœ€å¼€å§‹çš„ä»£ç ï¼š

```js
console.log(1)

// setTimeout1
setTimeout(() => {
  console.log(2)
  new Promise(resolve => {
    console.log(3)
    resolve()
  }).then(() => {
    // then4
    console.log(4)
  })
})

new Promise(resolve => {
  console.log(5)
  resolve()
}).then(() => {
  // then6
  console.log(6)
})

// setTimeout2
setTimeout(() => {
  console.log(7)
  new Promise(resolve => {
    console.log(8)
    resolve()
  }).then(() => {
    // then9
    console.log(9)
  })
})
```

ä¸ºäº†æ–¹ä¾¿ä¸‹é¢è®°å½•åˆ†æï¼Œå…ˆåœ¨ä»£ç ä¸Šåšä¸ªæ ‡è®°ã€‚å†æ ¹æ®ä¸Šé¢çš„äº‹ä»¶å¾ªç¯å¯¼å›¾å°±å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯
1. å®ä»»åŠ¡ï¼š æ•´ä½“script
2. å¾®ä»»åŠ¡ï¼šthen6
3. è¾“å‡º1ï¼Œ5ï¼Œ6

ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯

1. å®ä»»åŠ¡ï¼š setTimeout1
2. å¾®ä»»åŠ¡ï¼šthen4
3. è¾“å‡º2ï¼Œ3ï¼Œ4

ç¬¬ä¸‰è½®äº‹ä»¶å¾ªç¯

1. å®ä»»åŠ¡ï¼š setTimeout2
2. å¾®ä»»åŠ¡ï¼šthen9
3. è¾“å‡º7ï¼Œ8ï¼Œ9

æ‰€ä»¥åœ¨æµè§ˆå™¨ç«¯è¾“å‡ºçš„ç»“æœä¸º1ï¼Œ5ï¼Œ6ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ7ï¼Œ8ï¼Œ9ã€‚

æ¥ä¸‹å»æˆ‘ä»¬çœ‹ä¸‹åœ¨ Node ç¯å¢ƒä¸‹é‡Œå®ƒä¼šæ˜¯æ€ä¹ˆæ ·ï¼Ÿ

## Node Event Loop

å½“ nodejs å¯åŠ¨åï¼Œå®ƒä¼šåˆå§‹åŒ–äº‹ä»¶è½®è®­ï¼Œå®ƒå¯èƒ½ä¼šè°ƒç”¨ä¸€äº›å¼‚æ­¥APIï¼Œè°ƒåº¦å®šæ—¶å™¨ï¼Œæˆ–è€… `process.nextTick()` ç­‰ï¼Œç„¶åå¼€å§‹å¤„ç†äº‹ä»¶å¾ªç¯ã€‚

å®ƒä¼šåˆ†ä¸º6ä¸ªé˜¶æ®µï¼ŒæŒ‰ç…§é¡ºåºå¾ªç¯è¿›è¡Œï¼š

![](./img/node-eventLoop.jpg)

### timer

æœ¬é˜¶æ®µæ‰§è¡Œ `setTimeout` å’Œ `setInterval` çš„å›è°ƒã€‚

è®¡æ—¶å™¨æŒ‡å®šå¯ä»¥æ‰§è¡Œæ‰€æä¾›å›è°ƒçš„é˜ˆå€¼ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å¸Œæœ›å…¶æ‰§è¡Œçš„ç¡®åˆ‡æ—¶é—´ã€‚åœ¨æŒ‡å®šçš„ä¸€æ®µæ—¶é—´é—´éš”åï¼Œ è®¡æ—¶å™¨å›è°ƒå°†è¢«å°½å¯èƒ½æ—©åœ°è¿è¡Œã€‚ä½†æ˜¯ï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦æˆ–å…¶å®ƒæ­£åœ¨è¿è¡Œçš„å›è°ƒå¯èƒ½ä¼šå»¶è¿Ÿå®ƒä»¬ã€‚å®ƒä»¬ç”± poll é˜¶æ®µæ§åˆ¶ä½•æ—¶æ‰§è¡Œ

### I/O

ä¸Šä¸€è½®æœªæ‰§è¡Œçš„ï¼Œè¢«å»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå¾ªç¯è¿­ä»£çš„I/Oå›è°ƒ

### idleï¼Œprepare

ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨

### poll

è½®è¯¢é˜¶æ®µä¼šæœ‰ä¸¤ä¸ªé‡è¦åŠŸèƒ½ï¼š

1. è®¡ç®—é˜»å¡å’Œ poll I/Oçš„æ—¶é—´
2. æ‰§è¡Œ poll é˜Ÿåˆ—é‡Œçš„äº‹ä»¶

å¹¶ä¸”åœ¨è¿›å…¥è¯¥é˜¶æ®µæ—¶å¦‚æœæ²¡æœ‰è®¾å®šäº† timer çš„è¯ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…

1. å¦‚æœ poll é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…è¾¾åˆ°ç³»ç»Ÿé™åˆ¶
2. å¦‚æœ poll é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿï¼š
- å¦‚æœæœ‰ `setImmediate` å›è°ƒéœ€è¦æ‰§è¡Œï¼Œpoll é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° check é˜¶æ®µæ‰§è¡Œå›è°ƒ
- å¦‚æœæ²¡æœ‰ `setImmediate` å›è°ƒéœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒï¼Œè¿™é‡ŒåŒæ ·ä¼šæœ‰ä¸ªè¶…æ—¶æ—¶é—´è®¾ç½®é˜²æ­¢ä¸€ç›´ç­‰å¾…ä¸‹å»

å½“ç„¶è®¾å®šäº† timer çš„è¯ä¸” poll é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ timer è¶…æ—¶ï¼Œå¦‚æœæœ‰çš„è¯ä¼šå›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚

### check

check é˜¶æ®µæ‰§è¡Œ `setImmediate`

### close callbacks

å¦‚æœå¥—æ¥å­—æˆ–å¥æŸ„çªç„¶å…³é—­ï¼ˆä¾‹å¦‚`socket.destroy()`ï¼‰ï¼Œåˆ™åœ¨æ­¤é˜¶æ®µå°†å‘å‡º'close'äº‹ä»¶ã€‚å¦åˆ™å®ƒå°†é€šè¿‡`process.nextTick()`å‘å‡ºã€‚

äº†è§£äº†è¿™äº›é˜¶æ®µåï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç å†æ¥ç†è§£ä¸€ä¸‹ã€‚

é¦–å…ˆåœ¨æŸç§ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨timerçš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ã€‚

```js
setTimeout(() => {
  console.log('setTimeout')
}, 0)
setImmediate(() => {
   console.log('setImmediate')
})
```

ç»“æœæ˜¯ setTimeout å¯èƒ½æ‰§è¡Œåœ¨å‰ä¹Ÿå¯èƒ½åœ¨åã€‚
äº‹ä»¶å¾ªç¯çš„å»¶è¿Ÿå¯èƒ½è¶³å¤Ÿä½ï¼Œä»¥è‡³äºè®¡æ—¶å™¨åœ¨ç«‹å³è§¦å‘åè§¦å‘ï¼Œæœ¬èº«äº‹ä»¶å¾ªç¯ä¹Ÿæ˜¯éœ€è¦æˆæœ¬çš„ï¼Œå¦‚æœåœ¨å‡†å¤‡æ—¶å€™èŠ±è´¹äº†å¤§äº 1ms çš„æ—¶é—´ï¼Œé‚£ä¹ˆåœ¨ timer é˜¶æ®µå°±ä¼šç›´æ¥æ‰§è¡Œ setTimeout å›è°ƒï¼Œå¦‚æœå‡†å¤‡æ—¶é—´èŠ±è´¹å°äº 1msï¼Œé‚£ä¹ˆå°±æ˜¯ setImmediate å›è°ƒå…ˆæ‰§è¡Œäº†ã€‚

åœ¨ä¸‹é¢è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæ‰§è¡Œé¡ºåºä¸€å®šæ˜¯å›ºå®šçš„

```js
const fs = require('fs')

fs.readFile(__filename, () => {
  setTimeout(() => {
    console.log('timeout');
  }, 0)
  setImmediate(() => {
    console.log('immediate')
  })
})
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒsetImmediate æ°¸è¿œå…ˆæ‰§è¡Œã€‚å› ä¸ºä¸¤ä¸ªä»£ç å†™åœ¨ IO å›è°ƒä¸­ï¼ŒIO å›è°ƒæ˜¯åœ¨ poll é˜¶æ®µæ‰§è¡Œï¼Œå½“å›è°ƒæ‰§è¡Œå®Œæ¯•åé˜Ÿåˆ—ä¸ºç©ºï¼Œå‘ç°å­˜åœ¨ setImmediate å›è°ƒï¼Œæ‰€ä»¥å°±ç›´æ¥è·³è½¬åˆ° check é˜¶æ®µå»æ‰§è¡Œå›è°ƒäº†ã€‚

æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ Node ä¸­çš„ `process.nextTick`ï¼Œè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ç‹¬ç«‹äº Event Loop ä¹‹å¤–çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„é˜Ÿåˆ—ï¼Œå½“æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œå¦‚æœå­˜åœ¨ nextTick é˜Ÿåˆ—ï¼Œå°±ä¼šæ¸…ç©ºé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”ä¼˜å…ˆäºå…¶ä»– microtask æ‰§è¡Œã€‚

```js
setTimeout(() => {
 console.log('timer1')

 Promise.resolve().then(function() {
   console.log('promise1')
 })
}, 0)

process.nextTick(() => {
 console.log('nextTick')
 process.nextTick(() => {
   console.log('nextTick')
   process.nextTick(() => {
     console.log('nextTick')
   })
 })
})
```

å¯¹äºä»¥ä¸Šä»£ç ï¼Œæ— è®ºå¦‚ä½•ï¼Œæ°¸è¿œéƒ½æ˜¯å…ˆæŠŠ nextTick å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚
äº†è§£äº† node çš„äº‹ä»¶å¾ªç¯ä»¥åï¼Œå†å›è¿‡å¤´æ¥çœ‹çœ‹æœ€åˆå§‹çš„ä¾‹å­ï¼Œä½ å°±ä¼šå‘ç°å®ƒè¾“å‡ºçš„ç»“æœæ˜¯ï¼š1, 5, 6, 2, 3, 7, 8, 4, 9ã€‚

æ€»ç»“ä¸€ä¸‹ node çš„æ‰§è¡Œæœºåˆ¶å¤§æ¦‚å¦‚ä¸‹ï¼š
![](./img/node-event-loop.jpg)

## æœ€å
1. javascript æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€
2. Event Loopæ˜¯ javascript çš„æ‰§è¡Œæœºåˆ¶
3. EVent Loopåœ¨æµè§ˆå™¨å’Œ Node ç¯å¢ƒä¸‹å´åˆæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„æœºåˆ¶

## æ€è€ƒ
ç•™ä¸‹ä¸€é“æ‰©å±•é¢˜ï¼Œç»“åˆasyncï¼Œawaitï¼Œåœ¨æµè§ˆå™¨å’Œnodeç¯å¢ƒä¸‹åˆè¾“å‡ºä»€ä¹ˆï¼Ÿ
```js
asyncÂ functionÂ async1()Â {Â Â Â Â Â 
  console.log("async1Â start");Â Â Â Â Â Â 
Â Â awaitÂ async2();Â Â Â Â Â 
Â  console.log("async1Â end");
}Â Â 
asyncÂ functionÂ async2()Â {Â Â Â Â 
  console.log('async2');Â 
  setTimeout(() => {
    console.log('async-settimeout');Â 
  }, 0);
  newÂ Promise(functionÂ (resolve)Â {Â Â Â Â Â Â 
    console.log("async2-promise");Â Â Â Â Â Â 
    resolve();Â Â 
  }).then(functionÂ ()Â {Â Â Â Â Â Â 
    console.log("async2-then");Â 
  });Â 
}

console.log("scriptÂ start");Â Â 
setTimeout(functionÂ ()Â {Â Â Â Â Â Â 
  console.log("settimeout");Â Â 
},0);
  
async1();Â Â 
  
newÂ Promise(functionÂ (resolve)Â {Â Â Â Â Â Â 
  console.log("promise1");Â Â Â Â Â Â 
  resolve();Â Â 
}).then(functionÂ ()Â {Â Â Â Â Â Â 
  console.log("promise2");Â 
});Â 
console.log('scriptÂ end');Â 
```

