# 前端安全CSRF && XSS
## 前言

随着互联网的发达，各种WEB应用也变得越来越复杂，满足了用户的各种需求，但是随之而来的就是各种网络安全的问题。作为前端工程师的我们也逃不开这个问题。所以今天，就和大家一起聊一聊WEB前端的安全那些事儿。这里就不去说那些后端的攻击(SQL注入、DDOS攻击等)。

## 为什么要攻击？

其实真正为了玩的心态去进行黑网站的人，还是少数。多数攻击还是有利益的成分在里面的。开发者不可能确保自己的应用绝对无法被攻击，但是只要攻击我们的时候，骇客花费的成本远比他可以获取的利益大得多，骇客就不会去攻击。防范强如支付宝、QQ等产品，也都曾被报过漏洞，看来防御不是绝对的，我们只能想办法让我们的应用更加安全。

## 前端攻击形式以及如何防范

1. CSRF（Cross-site request forgery），通常称为跨站请求伪造
2. XSS（Cross-site scripting），通常称为跨域脚本攻击

### CSRF 攻击原理

![](./img/CSRF.png)

如图所示，被攻击的前提就很明了了，**用户需要在A网站登录过，并且网站A存在接口漏洞**

### CSRF 防范

因此根据上述进行对症下药进行防范

1. Token验证: 访问接口的时候，浏览器会自动上传cookie，不会上传token，所以进行token验证
2. Referer验证: 服务器判断是否是该站点下的页面，是的话执行，反之拦截
3. 隐藏令牌: 跟token有点像，比如把验证信息隐藏在header上 

### XSS 攻击原理

XSS 攻击是 Web 攻击中最常见的攻击方法之一，它是通过对网页注入可执行代码且成功地被浏览器执行，达到攻击的目的，形成了一次有效XSS攻击，一旦攻击成功，它可以获取用户的联系人列表，然后向联系人发送虚假诈骗信息，可以删除用户的日志等等，有时候还和其他攻击方式同时实施比如 SQL 注入攻击服务器和数据库、Click劫持、相对链接劫持等实施钓鱼，它带来的危害是巨大的，是web安全的头号大敌。

Web 应用程序的技术基础是由 HTTP 和 HTML 组成的。HTTP 协议是 HTML 的传输机制，可使用代码设计 Web 页面布局和生成页面。如果 Web 应用程序接受用户通过 HTTP 请求（如 GET 或 POST）提交的输入信息，然后使用输出 HTML 代码在某些地方显示这些信息，便可能存在 XSS 漏洞。

实施 XSS 攻击需要具备两个条件：

1. 需要向web页面注入恶意代码
2. 这些恶意代码能够被浏览器成功的执行

### XSS 攻击类型

1. 反射型攻击: 恶意代码并没有保存在目标网站，通过引诱用户点击一个链接到目标网站的恶意链接来实施攻击的
2. 存储型攻击: 恶意代码被保存到目标网站的服务器中，这种攻击具有较强的稳定性和持久性，比较常见场景是在博客，论坛等社交网站上，但OA系统，和CRM系统上也能看到它身影，比如：某CRM系统的客户投诉功能上存在XSS存储型漏洞，骇客提交了恶意攻击代码，当系统管理员查看投诉信息时恶意代码执行，窃取了客户的资料，然而管理员毫不知情，这就是典型的XSS存储型攻击

了解了 XSS 的原理，接下去看看怎么防范吧。

### XSS 防范

1. 在表单提交或者url参数传递前，对需要的参数进行过滤
2. 过滤用户输入的，检查用户输入的内容中是否有非法内容。如<>、"、 '、%、;、()、&、+等。严格控制输出

可以利用下面这些函数对出现 xss 漏洞的参数进行过滤:

1、htmlspecialchars() 函数，用于转义处理在页面上显示的文本。

2、htmlentities() 函数，用于转义处理在页面上显示的文本。

3、strip_tags() 函数，过滤掉输入、输出里面的恶意标签。

4、header() 函数，使用header("Content-type:application/json"); 用于控制 json 数据的头部，不用于浏览。

5、urlencode() 函数，用于输出处理字符型参数带入页面链接中。

6、intval() 函数用于处理数值型参数输出页面中。

7、自定义函数，在大多情况下，要使用一些常用的 html 标签，以美化页面显示，如留言、小纸条。那么在这样的情况下，要采用白名单的方法使用合法的标签显示，过滤掉非法的字符。
